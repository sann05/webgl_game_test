<!DOCTYPE html>
<html lang="en-us">
  <head>
    <meta charset="utf-8">
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8">
    <title>Unity WebGL Player | ZombieTrain_Dev</title>
    <link rel="shortcut icon" href="TemplateData/favicon.ico">
    <link rel="stylesheet" href="TemplateData/style.css">
    <script src="https://telegram.org/js/telegram-web-app.js"></script> <!-- Telegram SDK -->
	<script src="https://cdn.devtodev.com/sdk/web/v2/devtodevsdk.js"></script>
    <script src="https://unpkg.com/@tonconnect/ui@latest/dist/tonconnect-ui.min.js"></script> <!-- TonConnect UI -->
    <style>
      html, body {
        margin: 0;
        padding: 0;
        overflow: hidden;
        height: 100%;
      }
      #unity-container {
        width: 100vw;
        height: 100vh;
        position: absolute;
        top: 0;
        left: 0;
      }
      canvas {
        width: 100% !important;
        height: 100% !important;
        max-width: 1080px;
        margin: 0 auto;
      }
      @media screen and (orientation: landscape) {
        body::before {
          content: "Please rotate your device to portrait mode";
          position: absolute;
          top: 50%;
          left: 50%;
          transform: translate(-50%, -50%);
          font-size: 24px;
          color: #333;
        }
        canvas {
          display: none;
        }
      }
    </style>
  </head>
  <body>
    <div id="unity-container" class="unity-desktop">
      <canvas id="unity-canvas" width="1080" height="1920" tabindex="-1"></canvas>
      <div id="unity-loading-bar">
        <div id="unity-logo"></div>
        <div id="unity-progress-bar-empty">
          <div id="unity-progress-bar-full"></div>
        </div>
      </div>
      <div id="unity-warning"></div>
      <div id="unity-footer">
        <div id="unity-webgl-logo"></div>
        <div id="unity-fullscreen-button"></div>
        <div id="unity-build-title">ZombieTrain_Dev</div>
      </div>
    </div>

    <!-- Load Unity WebGL-related script -->
    <script src="unity-loader.js"></script>
    <!-- Load Telegram-related script -->
    <script src="telegram-integration.js"></script>
    <script>
      window.addEventListener('message', ({ data }) => {
        console.log("TEST!!!: Message received:", JSON.stringify(data));
      });
      console.log("TEST!!!: Posting message to parent");
      try {
        const data = JSON.stringify({
        eventType: 'web_app_setup_back_button',
          eventData: {
            is_visible: true,
          },
        });
        window.parent.postMessage(data, 'https://web.telegram.org');
      } catch (error) {
        console.error("TEST!!!: Error posting message:", error);
      }
      try {
        const data = JSON.stringify({ is_visible: true });
        window.TelegramWebviewProxy.postEvent('web_app_setup_back_button', data);
      } catch (error) {
        console.error("TEST!!!: Error posting message:", error);
      }


      Telegram.WebApp.onEvent('backButtonClicked', function() {
        console.log("TEST!!!: Back button clicked onEvent");
      });

      Telegram.WebApp.onEvent('deactivated', function() {
        console.log("TEST!!!: Deactivated onEvent");
      });

      Telegram.WebApp.BackButton.onClick(function() {
        console.log("TEST!!!: Back button clicked onClick");
      });
    </script>
  </body>
</html>

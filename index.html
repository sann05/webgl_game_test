<!DOCTYPE html>
<html lang="en-us">
  <head>
    <meta charset="utf-8">
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8">
    <title>Unity WebGL Player | ZombieTrain_Dev</title>
    <link rel="shortcut icon" href="TemplateData/favicon.ico">
    <link rel="stylesheet" href="TemplateData/style.css">
    <script src="https://telegram.org/js/telegram-web-app.js"></script> <!-- Telegram SDK -->
    <script src="https://cdn.devtodev.com/sdk/web/v2/devtodevsdk.js"></script> <!-- DevToDev SDK -->
    <script src="https://unpkg.com/@tonconnect/ui@latest/dist/tonconnect-ui.min.js"></script> <!-- TonConnect UI -->
    <style>
      html, body {
        margin: 0;
        padding: 0;
        overflow: hidden;
        height: 100%;
      }
      #unity-container {
        width: 100vw;
        height: 100vh;
        position: absolute;
        top: 0;
        left: 0;
      }
      canvas {
        width: 100% !important;
        height: 100% !important;
        max-width: 1080px;
        margin: 0 auto;
      }
      @media screen and (orientation: landscape) {
        body::before {
          content: "Please rotate your device to portrait mode";
          position: absolute;
          top: 50%;
          left: 50%;
          transform: translate(-50%, -50%);
          font-size: 24px;
          color: #333;
        }
        canvas {
          display: none;
        }
      }
    </style>
  </head>
  <body>
    <div id="unity-container" class="unity-desktop">
      <canvas id="unity-canvas" width="1080" height="1920" tabindex="-1"></canvas>
      <div id="unity-loading-bar">
        <div id="unity-logo"></div>
        <div id="unity-progress-bar-empty">
          <div id="unity-progress-bar-full"></div>
        </div>
      </div>
      <div id="unity-warning"></div>
      <div id="unity-footer">
        <div id="unity-webgl-logo"></div>
        <div id="unity-fullscreen-button"></div>
        <div id="unity-build-title">ZombieTrain_Dev</div>
      </div>
    </div>

    <script>
	
		// Initialize TonConnect UI with the manifest URL
		const tonConnectUI = new TON_CONNECT_UI.TonConnectUI({
		manifestUrl: 'https://webgl-game-test-nine.vercel.app/tonconnect-manifest.json'
		});
		console.log('TonConnect initialized:', tonConnectUI);


		// Function to connect to the wallet
		async function connectToWallet() 
		{
			try 
			{
			  const connectedWallet = await tonConnectUI.connectWallet();
			  console.log('Wallet Connected:', connectedWallet);
			  return connectedWallet; // Ensure the wallet info is returned after a successful connection
			} 
			catch (error) 
			{
			  console.error('Error connecting to wallet:', error);
			  return null;
			}
		}


		// Function to send a transaction
		async function sendTransaction() 
		{
			try 
			{
			  const walletInfo = tonConnectUI.wallet;
			  if (!walletInfo) 
			  {
				console.error('Wallet not connected. Please connect a wallet first.');
				alert('Please connect your wallet before sending a transaction.');
				return;
			  }

			  const transaction = {
				messages: [
				  {
					address: "EQABa48hjKzg09hN_HjxOic7r8T1PleIy1dRd8NvZ3922MP0", // Destination address
					amount: "1000000000" // Toncoin in nanotons (1 TON)
				  }
				]
			  };

			  const result = await tonConnectUI.sendTransaction(transaction);
			  console.log('Transaction Result:', result);
			} 
			catch (error) 
			{
			  console.error('Error sending transaction:', error);
			}
		}
		

		// Function to disconnect the wallet
		async function disconnectWallet() 
		{
			try 
			{
			  await tonConnectUI.disconnect();
			  console.log('Wallet disconnected.');
			} 
			catch (error) 
			{
			  console.error('Error disconnecting wallet:', error);
			}
		}


		// Example usage
		async function main() 
		{
			const connectedWallet = await connectToWallet();
			if (connectedWallet) 
			{
			  // Wallet connected, proceed to send a transaction
			  //await sendTransaction();
			  //await disconnectWallet();
			} 
			else 
			{
			  console.error('Wallet connection failed.');
			}
		}

		// Call the main function
		main();
	</script>

    <!-- Load Unity WebGL-related script -->
    <script src="unity-loader.js"></script>
    <!-- Load Telegram-related script -->
    <script src="telegram-integration.js"></script>
  </body>
</html>
